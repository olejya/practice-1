import telebot
from datetime import datetime, timedelta

TOKEN = 'ВАШ_ТОКЕН_ТУТ'  
bot = telebot.TeleBot(TOKEN)

# Словарь для хранения информации о пользователях
user_data = {}

@bot.message_handler(commands=['start_game'])
def start_game(message):
    user_id = message.from_user.id
    if user_id in user_data and user_data[user_id].get('session_active', False):
        bot.reply_to(message, "Вы уже начали игровую сессию! Чтобы закончить, используйте /end_game.")
    else:
        user_data.setdefault(user_id, {'total_time': timedelta(0)})
        user_data[user_id]['start_time'] = datetime.now()
        user_data[user_id]['session_active'] = True
        bot.reply_to(message, "Старт игрового времени засечён!")

@bot.message_handler(commands=['end_game'])
def end_game(message):
    user_id = message.from_user.id
    if user_id in user_data and user_data[user_id].get('session_active', False):
        start_time = user_data[user_id]['start_time']
        end_time = datetime.now()
        session_time = end_time - start_time
        user_data[user_id]['total_time'] += session_time
        user_data[user_id]['session_active'] = False
        bot.reply_to(
            message,
            f"Сессия завершена! Продолжительность этой сессии: {str(session_time).split('.')[0]}.\n"
            f"Общее игровое время: {str(user_data[user_id]['total_time']).split('.')[0]}"
        )
    else:
        bot.reply_to(message, "Вы ещё не начали сессию. Используйте /start_game.")

@bot.message_handler(commands=['my_stats'])
def my_stats(message):
    user_id = message.from_user.id
    total_time = user_data.get(user_id, {}).get('total_time', timedelta(0))
    bot.reply_to(message, f"Ваше общее игровое время: {str(total_time).split('.')[0]}")

# (Опционально) обработка остальных сообщений
@bot.message_handler(func=lambda message: True)
def echo_all(message):
    bot.reply_to(
        message,
        "Используйте /start_game чтобы начать, /end_game чтобы закончить, /my_stats чтобы посмотреть статистику."
    )

if __name__ == '__main__':
    print("Бот запущен!")
    bot.infinity_polling()
